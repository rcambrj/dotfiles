apiVersion: apps/v1
kind: Deployment
metadata:
  name: blueberry-proxy
  labels:
    app: blueberry-proxy
spec:
  revisionHistoryLimit: 1
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: blueberry-proxy
  template:
    metadata:
      labels:
        app: blueberry-proxy
    spec:
      nodeSelector:
        kubernetes.io/hostname: blueberry
      tolerations:
      - key: "proxy-only"
        operator: "Equal"
        value: "true"
        effect: "NoSchedule"
      containers:
      - name: homeassistant
        image: nixery.dev/shell/socat/curl
        command: ["/bin/sh", "-c"]
        args: [ "exec socat TCP-LISTEN:18123,fork,reuseaddr TCP:192.168.142.24:8123"]
        ports:
        - containerPort: 18123

      - name: dex
        image: nixery.dev/shell/socat/curl
        command: ["/bin/sh", "-c"]
        args: [ "exec socat TCP-LISTEN:15556,fork,reuseaddr TCP:192.168.142.24:5556"]
        ports:
        - containerPort: 15556

      - name: lldap-http
        image: nixery.dev/shell/socat/curl
        command: ["/bin/sh", "-c"]
        args: [ "exec socat TCP-LISTEN:15234,fork,reuseaddr TCP:192.168.142.24:5234"]
        ports:
        - containerPort: 15234
      - name: lldap-ldaps
        image: nixery.dev/shell/socat/curl
        command: ["/bin/sh", "-c"]
        args: [ "exec socat TCP-LISTEN:16360,fork,reuseaddr TCP:192.168.142.24:6360"]
        ports:
        - containerPort: 16360

      - name: grafana
        image: nixery.dev/shell/socat/curl
        command: ["/bin/sh", "-c"]
        args: [ "exec socat TCP-LISTEN:13000,fork,reuseaddr TCP:192.168.142.24:3000"]
        ports:
        - containerPort: 13000

      - name: loki
        image: nixery.dev/shell/socat/curl
        command: ["/bin/sh", "-c"]
        args: [ "exec socat TCP-LISTEN:13100,fork,reuseaddr TCP:192.168.142.24:3100"]
        ports:
        - containerPort: 13100

      - name: esphome
        image: nixery.dev/shell/socat/curl
        command: ["/bin/sh", "-c"]
        args: [ "exec socat TCP-LISTEN:16052,fork,reuseaddr TCP:192.168.142.24:6052"]
        ports:
        - containerPort: 16052

      - name: postgres
        image: nixery.dev/shell/socat/curl
        command: ["/bin/sh", "-c"]
        args: [ "exec socat TCP-LISTEN:15432,fork,reuseaddr TCP:192.168.142.24:5432"]
        ports:
        - containerPort: 15432
